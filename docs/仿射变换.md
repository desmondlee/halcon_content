---
weight: 10
date: 2021-01-07
title: "仿射变换"
---
# 仿射变换

仿射变换可以理解为“跟随”， 即目标物体移动到哪里，相应轮廓、ROI等跟随到哪里。

**在基于参考的视觉检测中，由于待检测图像与参考图像或多或少都会存在几何变化(平移、旋转、缩放等)，所以一般都要对待检测图像或ROI进行仿射变换操作。**

仿射变换有平移、旋转、缩放、斜切(切变)。

> 注，两个坐标系Y轴的旋转角度，叫斜切角。
>
> 机器X与Y 轴之间的角度不是绝对的90度，从原点沿着Y轴方向不断移动时，X方向的偏移会越来越大，在求图像坐标系和机器坐标系映射关系时，不能忽略了斜切角的影响。
>
> 九点标定可以比较准确的求出斜切角。



## 流程



{{< mermaid >}}
graph TD

A["获取特征点坐标，角度 "] --> B["计算仿射变换矩阵" ]
B --> C["对图像，区域，<br/>轮廓进行仿射变换"]
{{</ mermaid>}}



## 三种常见类型

- 根据特征点、角度计算仿射变换矩阵。

  如， `vector_angle_to_rigid`，支持平移、旋转，参数：

  | ---                         | 角度 | 位置(x,y)                       |
  | --------------------------- | ---- | ------------------------------- |
  | 对模板轮廓进行变换          | 0    | (0, 0)                          |
  | 对ROI进行变换(包括模板区域) | 0    | 模板区域中心(用area_center获得) |

  `hom_mat2d_scale`，支持缩放。

- 根据两个以上特征点计算仿射变换矩阵。

  如，	`vector_to_rigid`，支持平移、旋转；	`vector_to_similarity`，支持平移、旋转、缩放。

- 根据三个以上特征点获取仿射变换矩阵。

  如，`vector_to_hom_mat2d`，支持平移、旋转、缩放、斜切。

  适用于“手眼标定”（九点标定）、多相机标定到同一坐标系。

> ※重要：此算子处理的是，**画原模板时的区域**（如 circle, rectangle）位置(如area_center得到的中心点位置) 到 find_shape_model 得到的**新模板位置**的变换矩阵

## 常用的仿射变换

1. affine_trans_contour_xld: 对**XLD**轮廓进行仿射变换；
2. affine_trans_image: 对**图像**进行仿射变换；
3. affine_trans_point_2d: 对**二维点**进行仿射变换；
4. affine_trans_pixel: 对**图像点**进行仿射变换；
5. affine_trans_region: 对**区域**进行仿射变换。



[下载参考示例](http://qn.halcon.lizhenguo.cn/file/template.zip)