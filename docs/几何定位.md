---
weight: 7
date: 2020-12-27
title: "几何定位"
---

# 几何定位

通过几何特征(如模板轮廓)，来判断图像中是否有目标区域。



## 金字塔等级
等级越高，占用内存越少、匹配度要求越低；但等级过高时，会导致匹配出错

## 极性

- use_polarity
使用极性，在白色背景中找黑色目标

- ignore_global_polarity
忽略全局极性，可以在白色背景中找黑色目标，也可以在黑色背景中找白色目标

- ignore_local_polarity
忽略局部极性，可以适应更差的环境，可以在背景不稳定，如渐变的情况下找目标

## 匹配助手
- 贪心算法，值越大，处理时间越短，但可能会漏匹配部分区域，一般设置在0.7~0.8；
- 最大重叠，值越大，允许重叠的比例越大，但可能会匹配错；
- 最大变形，值越大，处理时间越长，但可以尝试匹配的区域越多；

## 对比度

对比度 = 相邻像素点、像素值的差值/距离



## 建模经验

1. 什么是关键轮廓，什么是干扰轮廓；
2. 边缘数量越少越好；边缘数量多了，速度变慢；
3. 边缘越长越好；
4. 干扰边缘越少越好；
5. 关键边缘越长越好，占模板轮廓的比例越多越好；
6. 可以使用PS软件，制造理想的模板图像
7. 灵活运用区域操作技术，获取关键边缘区域；
   1. difference: 特别是回型区域、挖洞大法；
   2. union

## 定位经验

1. 频繁调节的参数：角度、缩放、分数、极性；
2. 多次搜索策略(分类)：匹配分数逐步降低；for循环
3. 合理设置旋转角度范围；
4. 合理设置贪婪度：定位要求高，贪婪度越小越好，但时间会边长；
5. 有效提高匹配分数的措施：缩放，会增加时间。（对分数提高效果：异步缩放 > 同步缩放 > 不缩放，要合理设置缩放)。



## 定位的主要作用

1. 最常用：粗定位 -> 仿射变换矩阵(模板轮廓变换矩阵、ROI变换矩阵) -> 模板轮廓跟随、ROI跟随；
2. 异形定位：对定位参数要求高；对于定位**准确性**、**精确性(edges_sub_pix)**理解要求高；
3. 定位结果是相对值，相对于模板的：
   1. xy： 对于同一个模板图像，每次重新建模，模板中心xy都会变，如果直接使用模板中心，每次都需要调节xy补偿量；如果使用blob或测量进行**精定位，则不需要调节**；
   2. 角度：如果是**异形件**， 没有办法抓直边或2个以上的mark点，直接使用模板角度(角度精度不是非常高)；如果有办法抓直边或2个以上的mark点，这种方法精度高。