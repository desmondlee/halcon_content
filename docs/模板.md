---
weight: 9
date: 2021-01-01
title: "模板"
---

# 创建&保存&读取&使用模板

##  经验

1. 金字塔等级(NumLevels)越高，匹配时间越短，但匹配越模糊，容易多匹配；
2. 贪婪度(Greedness)越高，匹配时间越长，匹配越精确；
3. 匹配分数(Score)越高，匹配越精确；
4. 单模板支持x,y同步缩放、异步缩放；多模板不支持缩放。

### 创建模板

```
dev_get_window (WindowHandle1)
dev_set_draw ('margin') //区域展示样式：边框
read_image (Image, 'printer_chip/printer_chip_01')//加载图像
draw_rectangle2 (WindowHandle1, Row2, Column, Phi, Length1, Length2)//绘制模板区域
gen_rectangle2 (Rectangle, Row2, Column, Phi, Length1, Length2)//展示区域
reduce_domain (Image, Rectangle, ImageReduced)//获取图像在区域内的部分内容图像
create_shape_model (ImageReduced, 'auto', 0, rad(45), 'auto', 'auto', 'use_polarity', 'auto', 'auto', ModelID)//将区域内的部分图像作为模板内容，制作模板

```

### 保存模板

```
write_shape_model (ModelID, 'C:/Users/lee/Desktop/model.shm')
```

### 读取模板

```
read_shape_model ('C:/Users/lee/Desktop/model.shm', ModelID)
```

### 使用(查找)模板

```
find_shape_model (Image, ModelID, rad(-45), rad(180), 0.5, 1, 0.5, 'least_squares', 0, 0.9, Row3, Column2, Angle, Score)//判定有无，此处是几何定位法

if (|Row3| > 0)
    vector_angle_to_rigid (0,0,0, Row3, Column2, Angle, HomMat2D)//获得变换矩阵HomMat2D
    
    get_shape_model_contours (ModelContours1, ModelID, 1)//会将模板轮廓显示在图像左上角，模板中心在图像坐标0，0的位置
    
    affine_trans_contour_xld (ModelContours1, ContoursAffineTrans1, HomMat2D)//根据变换矩阵，将模板轮廓仿射变换到对应的位置
    
else 
    disp_message (WindowHandle1, '未找到模板', 'window', 20, 20, 'red', 'false')
endif
```

#### 参考图

![使用模板](http://qn.halcon.lizhenguo.cn/image/shm.bmp)

