# 关键技术

3D测量适合测高度，X、Y方向的精度不高

## 线激光和相机的角度
一般在10~60度，角度越大，精度越高。。。

## 场合
拍摄反光较强的表面时，相机、激光都要与拍摄物有一定角度。

## Z方向分辨率
Z方向的分辨率 = X方向分辨率 * 常量(夹角决定)

简易算法： Z方向像素j单量 = Height / Width (Height:用于测量的矩形块高度， Width:视场长度)

## Z方向重复性
一体式相机： Z方向重复性 = X方向像素单量 * 系数 （系数在0.5 ~ 2 之间，初次选型，可采用参考值1.5）

分体式相机：Z方向重复性 = X方向像素单量 / tanα * 系数(1-3)   ， 角度参考值为45°(此时tanα = 1)

Z方向像素单量 = X方向像素单量 / tanα

## Y方向
线激光传感器在机器人手臂上时，是时间频率拍照，没法触发拍照。

## 扫描间隔/触发间隔

扫描间隔(距离, 单位mm) =  扫描(脉冲)间隔 * 脉冲单量



## 曝光方式

建议使用**多曝光**方式，特别是有色差的物体。



## 光亮控制

可以通过调整激光电压来改变激光的亮度。



## 轮廓线提取

1. 激光线与2D图像X轴平行；
2. 按列搜索；
3. 有效点阈值；
4. 有效点选择
5. 倾斜补正

## halcon图像数据类型

1. halcon算子支持的图像数据类型一般有限制，需要查看帮助文档，获取支持的类型
2. 常用图像数据类型：byte, uint2
3. 图像数据类型转化算子:convert_image_type
4. halcon轮廓匹配支持的类型：byte, uint2



## 参考面补正

1. 3D测量尽量做相对测量（相对于参考面），数据重复性好；避免做绝对测量；
2. 用**轮廓线**测量背景，若是平的(变化不大)，用大平面补正；若是凹凸不平的，用曲面补正(分割成多个小平面，再拉直补正)



## 3D测量常用方法

1. 高度差/段差

   在高度差测量位置，生成两个**临近** 的**区域**，求两个区域的平均高度值(min_max_gray)，两个高度值之差为该位置的高度差。

2. 平面度

   1. 生成一些小的测量点
   2. 多个三维点点拟合平面
   3. 。。。

3. 体积

   物体的体积 = X方向分辨率 * Y方向分辨率 * 物体面积(像素单位) * 高度平均值(单位mm)

## 轮廓和截面的2.5D测量

基于轮廓线的测量



## 激光器

最佳工作距离：65mm

要调节激光水平，使其与X轴平行



## 相机和镜头调节

1. 调节合适的曝光、增益、镜头光圈，让每列激光饱和（亮度值200以上）的像素个数达2个以上。曝光不能过大，否则会降低相机帧率。





## 备注

1. 点云图、高度图中的像素值是高度信息；
2. 亮度图的像素值是亮度信息；
3. 分频倍率 = X方向分辨率 / Y方向分辨率，然后取整；
4. 